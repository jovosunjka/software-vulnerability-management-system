package com.eds.EDSSolution.utils;

import org.kie.api.KieServices;
import org.kie.api.builder.KieBuilder;
import org.kie.api.builder.KieFileSystem;
import org.kie.api.runtime.KieContainer;
import org.kie.api.runtime.StatelessKieSession;
import org.kie.api.builder.Message.Level;

import java.io.File;

public class KieRulesBase {

    public static StatelessKieSession createStatelessSession() throws RuntimeException {

        if (ResourcesLocation.getInstance().getRulesLocation() == null) {
            return null;
        }

        KieServices kieServices = KieServices.Factory.get();
        KieFileSystem kieFileSystem = kieServices.newKieFileSystem();

        String rule_location = ResourcesLocation.getInstance().getRulesLocation();
        kieFileSystem.write(kieServices.getResources().newFileSystemResource(new File(rule_location)));

        kieServices.newKieBuilder(kieFileSystem).buildAll();

        KieContainer kieContainer = kieServices.newKieContainer(kieServices.getRepository().getDefaultReleaseId());

        return kieContainer.newStatelessKieSession();
    }

}
